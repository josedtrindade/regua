<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Régua 3.0 - Análise de Dupla Camada com OpenAI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab:hover {
            background: #5a6fd8;
            color: white;
        }
        
        .content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            opacity: 0.9;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .url-inputs {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .confidence-indicator {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
            text-align: center;
        }
        
        .verde-escuro {
            background: #1e7e34;
            color: white;
        }
        
        .verde-claro {
            background: #28a745;
            color: white;
        }
        
        .amarelo {
            background: #ffc107;
            color: #333;
        }
        
        .laranja {
            background: #fd7e14;
            color: white;
        }
        
        .vermelho {
            background: #dc3545;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .connection-status {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .connected {
            background: #d4edda;
            color: #155724;
        }
        
        .disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .ai-status {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .ai-indicator {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .ai-active {
            background: #d4edda;
            color: #155724;
        }
        
        .ai-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .analysis-steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 5px;
        }
        
        .step-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .step-pending {
            background: #6c757d;
            color: white;
        }
        
        .step-active {
            background: #007bff;
            color: white;
        }
        
        .step-complete {
            background: #28a745;
            color: white;
        }
        
        .step-error {
            background: #dc3545;
            color: white;
        }
        
        .security-badge {
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .analysis-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        
        .layer-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .team-analysis {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .criteria-table {
            width: 100%;
            margin-top: 10px;
        }
        
        .criteria-table th,
        .criteria-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        .score-high {
            background: #d4edda;
            color: #155724;
        }
        
        .score-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .score-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .recommendation-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .recommendation-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .collapsible {
            background: #f1f1f1;
            color: #444;
            cursor: pointer;
            padding: 15px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
            font-weight: 600;
            border-radius: 5px;
            margin: 5px 0;
        }
        
        .collapsible:hover {
            background: #ddd;
        }
        
        .collapsible.active {
            background: #667eea;
            color: white;
        }
        
        .collapsible-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            background: white;
            border-radius: 0 0 5px 5px;
        }
        
        .collapsible-content.active {
            padding: 15px;
            max-height: 1000px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚽ Régua 3.0 - Análise de Dupla Camada</h1>
            <p>Sistema Inteligente de Análise de Futebol com Metodologia Completa <span class="security-badge">🔒 SEGURO</span></p>
        </div>
        
        <div id="connectionStatus" class="connection-status disconnected">
            🔄 Conectando ao banco de dados...
        </div>
        
        <div class="ai-status">
            <div id="openaiStatus" class="ai-indicator ai-active">🧠 OpenAI GPT-4: Ativo e Seguro</div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">📊 Dashboard</button>
            <button class="tab" onclick="showTab('nova-analise')">➕ Nova Análise</button>
            <button class="tab" onclick="showTab('historico')">📋 Histórico</button>
            <button class="tab" onclick="showTab('metodologia')">📚 Metodologia</button>
            <button class="tab" onclick="showTab('sobre')">ℹ️ Sobre</button>
        </div>
        
        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>📊 Performance da Régua 3.0</h2>
                
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <h3 id="totalJogos">-</h3>
                        <p>Total de Jogos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="taxaAcerto">-</h3>
                        <p>Taxa de Acerto Geral</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="verdeEscuroAcerto">-</h3>
                        <p>Verde Escuro</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="verdeClaroAcerto">-</h3>
                        <p>Verde Claro</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="amareloAcerto">-</h3>
                        <p>Amarelo</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="laranjaAcerto">-</h3>
                        <p>Laranja</p>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
                
                <div class="table-container">
                    <h3>🎯 Últimas Análises</h3>
                    <table id="ultimasAnalises">
                        <thead>
                            <tr>
                                <th>Jogo</th>
                                <th>Nível</th>
                                <th>Cenário</th>
                                <th>Previsão</th>
                                <th>Resultado</th>
                                <th>Acerto</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Nova Análise Tab -->
            <div id="nova-analise" class="tab-content">
                <h2>➕ Nova Análise com Régua 3.0</h2>
                
                <div class="success">
                    <h4>🔒 Sistema Seguro</h4>
                    <p>Sua chave OpenAI está protegida no servidor. A análise segue fielmente a metodologia "Régua 3.0 - Análise de Dupla Camada" com 12 diretrizes específicas.</p>
                </div>
                
                <form id="novaAnaliseForm">
                    <div class="form-group">
                        <label>🏆 Jogo (ex: Flamengo x Palmeiras)</label>
                        <input type="text" id="jogoInput" placeholder="Time Mandante x Time Visitante" required>
                    </div>
                    
                    <div class="form-group">
                        <label>🏆 Campeonato</label>
                        <input type="text" id="campeonatoInput" placeholder="Ex: Campeonato Brasileiro - Série A" required>
                    </div>
                    
                    <div class="url-inputs">
                        <div class="form-group">
                            <label>📰 URL Notícia 1 (obrigatória)</label>
                            <input type="url" id="url1" placeholder="https://globoesporte.globo.com/..." required>
                        </div>
                        <div class="form-group">
                            <label>📰 URL Notícia 2 (opcional)</label>
                            <input type="url" id="url2" placeholder="https://espn.com.br/...">
                        </div>
                        <div class="form-group">
                            <label>📰 URL Notícia 3 (opcional)</label>
                            <input type="url" id="url3" placeholder="https://lance.com.br/...">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn" id="analisarBtn">
                        🧠 Analisar com Régua 3.0
                    </button>
                </form>
                
                <div id="analysisSteps" class="analysis-steps" style="display: none;">
                    <h4>🔄 Progresso da Análise:</h4>
                    <div class="step" id="step1">
                        <div class="step-icon step-pending">1</div>
                        <span>Coletando dados das URLs...</span>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-icon step-pending">2</div>
                        <span>Aplicando as 12 diretrizes de ponderação...</span>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-icon step-pending">3</div>
                        <span>Executando Camada 1 (9 critérios circunstanciais)...</span>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-icon step-pending">4</div>
                        <span>Executando Camada 2 (4 critérios estruturais)...</span>
                    </div>
                    <div class="step" id="step5">
                        <div class="step-icon step-pending">5</div>
                        <span>Gerando veredito final e recomendações...</span>
                    </div>
                    <div class="step" id="step6">
                        <div class="step-icon step-pending">6</div>
                        <span>Salvando análise completa...</span>
                    </div>
                </div>
                
                <div id="resultadoAnalise" style="margin-top: 30px;"></div>
            </div>
            
            <!-- Histórico Tab -->
            <div id="historico" class="tab-content">
                <h2>📋 Histórico Completo</h2>
                
                <div class="form-group">
                    <label>🔍 Filtrar por Nível</label>
                    <select id="filtroNivel" onchange="filtrarHistorico()">
                        <option value="">Todos os níveis</option>
                        <option value="Verde Escuro">Verde Escuro (90-100%)</option>
                        <option value="Verde Claro">Verde Claro (80-89%)</option>
                        <option value="Amarelo">Amarelo (70-79%)</option>
                        <option value="Laranja">Laranja (60-69%)</option>
                        <option value="Vermelho">Vermelho (<60%)</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <table id="historicoCompleto">
                        <thead>
                            <tr>
                                <th>Jogo</th>
                                <th>Campeonato</th>
                                <th>Nível</th>
                                <th>Cenário</th>
                                <th>Confiança %</th>
                                <th>Previsão</th>
                                <th>Resultado</th>
                                <th>Acerto</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Metodologia Tab -->
            <div id="metodologia" class="tab-content">
                <h2>📚 Metodologia Régua 3.0</h2>
                
                <div class="analysis-section">
                    <h3>🎯 Visão Geral</h3>
                    <p>A Régua 3.0 é um sistema de análise de futebol baseado em <strong>Dupla Camada</strong> com <strong>12 diretrizes específicas</strong> de ponderação para cenários do futebol brasileiro e internacional.</p>
                </div>
                
                <button class="collapsible">📋 12 Diretrizes de Ponderação</button>
                <div class="collapsible-content">
                    <ol>
                        <li><strong>Regra do Desgaste Logístico:</strong> Equipes com jogos decisivos no meio da semana</li>
                        <li><strong>Regra do Clássico de Desespero:</strong> Clássicos com times em situações extremas</li>
                        <li><strong>Regra do Fator Climático/Campo:</strong> Condições extremas de clima ou gramado</li>
                        <li><strong>Regra do Leão Ferido:</strong> Times qualificados em sequência negativa</li>
                        <li><strong>Alerta de Zebra por Calamidade:</strong> Desfalques massivos vs adversário sem pressão</li>
                        <li><strong>Regra da Ressaca Heroica:</strong> Efeito pós-glória em grandes feitos</li>
                        <li><strong>Regra da Reversão à Média:</strong> Despertar do gigante adormecido</li>
                        <li><strong>Times de Meio de Tabela x Mandantes Desesperados:</strong> Neutralização do favoritismo</li>
                        <li><strong>Empate na Ida:</strong> Rebaixamento automático de nível</li>
                        <li><strong>O Miolo Perigosíssimo:</strong> Diferença mínima de pontos (0-2)</li>
                        <li><strong>Alerta de Zebra (Verde Claro):</strong> Verificação secundária de risco</li>
                        <li><strong>Volatilidade Amarela:</strong> Zona de alta imprevisibilidade</li>
                    </ol>
                </div>
                
                <button class="collapsible">🔍 Camada 1: Força Circunstancial (9 Critérios)</button>
                <div class="collapsible-content">
                    <table class="criteria-table">
                        <tr>
                            <th>Critério</th>
                            <th>Descrição</th>
                            <th>Peso</th>
                        </tr>
                        <tr>
                            <td>B. Motivação</td>
                            <td>Importância do jogo, rivalidade, objetivos</td>
                            <td>Alto</td>
                        </tr>
                        <tr>
                            <td>C. Desfalques</td>
                            <td>Ausências confirmadas/prováveis</td>
                            <td>Alto</td>
                        </tr>
                        <tr>
                            <td>D. Psicológico</td>
                            <td>Clima recente, confiança, pressão</td>
                            <td>Alto</td>
                        </tr>
                        <tr>
                            <td>E. Momento na Tabela</td>
                            <td>Classificação e necessidade do resultado</td>
                            <td>Médio</td>
                        </tr>
                        <tr>
                            <td>F. Mando de Campo</td>
                            <td>Estádio, torcida, condições locais</td>
                            <td>Médio</td>
                        </tr>
                        <tr>
                            <td>G. Elenco/Estratégia</td>
                            <td>Encaixe tático para o confronto</td>
                            <td>Alto</td>
                        </tr>
                        <tr>
                            <td>H. Forma Recente</td>
                            <td>Performance dos últimos jogos</td>
                            <td>Alto</td>
                        </tr>
                        <tr>
                            <td>I. Confronto Direto</td>
                            <td>Histórico recente entre as equipes</td>
                            <td>Médio</td>
                        </tr>
                        <tr>
                            <td>J. Logística/Fadiga</td>
                            <td>Sequência de jogos e viagens</td>
                            <td>Médio</td>
                        </tr>
                    </table>
                </div>
                
                <button class="collapsible">🏗️ Camada 2: Força Estrutural (4 Critérios Ponderados)</button>
                <div class="collapsible-content">
                    <table class="criteria-table">
                        <tr>
                            <th>Critério</th>
                            <th>Descrição</th>
                            <th>Peso</th>
                        </tr>
                        <tr>
                            <td>1. Qualidade Estrutural</td>
                            <td>Força, profundidade e poder de decisão do plantel</td>
                            <td>3x</td>
                        </tr>
                        <tr>
                            <td>2. Consistência Tática</td>
                            <td>Estabilidade de performance e solidez do modelo</td>
                            <td>2x</td>
                        </tr>
                        <tr>
                            <td>3. Resiliência Mental</td>
                            <td>Histórico de reação à adversidade e pressão</td>
                            <td>2x</td>
                        </tr>
                        <tr>
                            <td>4. Fator Técnico/Gerencial</td>
                            <td>Qualidade do treinador e organização</td>
                            <td>1x</td>
                        </tr>
                    </table>
                </div>
                
                <button class="collapsible">🎨 Sistema de Cores de Confiança</button>
                <div class="collapsible-content">
                    <div class="confidence-indicator verde-escuro">🟢 Verde Escuro (90-100%) - Favoritismo consolidado, cenário limpo</div>
                    <div class="confidence-indicator verde-claro">🟢 Verde Claro (80-89%) - Favoritismo sólido, pequenas incertezas</div>
                    <div class="confidence-indicator amarelo">🟡 Amarelo (70-79%) - Jogo instável, favoritismo frágil</div>
                    <div class="confidence-indicator laranja">🟠 Laranja (60-69%) - Alto risco, fatores de zebra ativos</div>
                    <div class="confidence-indicator vermelho">🔴 Vermelho (<60%) - Jogo imponderável, máxima imprevisibilidade</div>
                </div>
            </div>
            
            <!-- Sobre Tab -->
            <div id="sobre" class="tab-content">
                <h2>ℹ️ Sobre a Régua 3.0</h2>
                
                <div style="line-height: 1.6;">
                    <h3>🎯 Metodologia Completa</h3>
                    <p>Sistema de análise de futebol baseado em <strong>Dupla Camada</strong> com metodologia científica:</p>
                    <ul style="margin: 15px 0 15px 30px;">
                        <li><strong>12 Diretrizes Específicas:</strong> Regras de ponderação para cenários únicos</li>
                        <li><strong>Camada 1:</strong> 9 critérios circunstanciais (0-10 cada)</li>
                        <li><strong>Camada 2:</strong> 4 critérios estruturais ponderados</li>
                        <li><strong>Sistema de Cores:</strong> 5 níveis de confiança</li>
                        <li><strong>Fluxo Obrigatório:</strong> Coleta → Análise → Veredito → Recomendações</li>
                    </ul>
                    
                    <h3>📊 Níveis de Confiança Detalhados</h3>
                    <div class="confidence-indicator verde-escuro">🟢 Verde Escuro (90-100%) → Apostar seco / coluna única</div>
                    <div class="confidence-indicator verde-claro">🟢 Verde Claro (80-89%) → Recomendação: 1 ou 2, segurança 1X/2X</div>
                    <div class="confidence-indicator amarelo">🟡 Amarelo (70-79%) → Duplo obrigatório (1X ou X2)</div>
                    <div class="confidence-indicator laranja">🟠 Laranja (60-69%) → Duplo aberto (12) ou Triplo</div>
                    <div class="confidence-indicator vermelho">🔴 Vermelho (<60%) → Triplo (1X2)</div>
                    
                    <h3>🧠 Integração com OpenAI GPT-4</h3>
                    <p>O sistema utiliza OpenAI GPT-4 com configuração otimizada:</p>
                    <ul style="margin: 15px 0 15px 30px;">
                        <li><strong>Modelo:</strong> GPT-4 (mais avançado que GPT-3.5)</li>
                        <li><strong>Temperature:</strong> 0 (máxima precisão)</li>
                        <li><strong>Max Tokens:</strong> 4096+ (análises completas)</li>
                        <li><strong>System + User Messages:</strong> Prompt estruturado</li>
                        <li><strong>🔒 Segurança:</strong> Chave protegida no servidor</li>
                    </ul>
                    
                    <h3>🔄 Processo Completo de Análise</h3>
                    <ol style="margin: 15px 0 15px 30px;">
                        <li><strong>Coleta de Dados:</strong> Extração de conteúdo das URLs</li>
                        <li><strong>Aplicação das 12 Diretrizes:</strong> Ponderação de cenários específicos</li>
                        <li><strong>Camada 1:</strong> Avaliação dos 9 critérios circunstanciais</li>
                        <li><strong>Camada 2:</strong> Avaliação dos 4 critérios estruturais ponderados</li>
                        <li><strong>Veredito Final:</strong> Análise de conflito e classificação de cenário</li>
                        <li><strong>Recomendações:</strong> Para todos os mercados (resultado, gols, ambos marcam, loteca)</li>
                    </ol>
                    
                    <h3>🛡️ Segurança e Confiabilidade</h3>
                    <p>Sua chave OpenAI fica protegida no servidor através de Environment Variables. O sistema segue fielmente a metodologia "Régua 3.0 - Análise de Dupla Camada" sem simplificações.</p>
                    
                    <h3>📈 Melhorias Implementadas</h3>
                    <ul style="margin: 15px 0 15px 30px;">
                        <li>✅ Prompt completo com todas as 12 diretrizes</li>
                        <li>✅ Metodologia de dupla camada implementada</li>
                        <li>✅ Sistema de cores de confiança (5 níveis)</li>
                        <li>✅ Fluxo de trabalho obrigatório</li>
                        <li>✅ JSON estruturado para análise completa</li>
                        <li>✅ Recomendações para todos os mercados</li>
                        <li>✅ Interface adaptada para análise detalhada</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuração do Supabase
        const SUPABASE_URL = 'https://shjjweviipblcjukvxry.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNoamp3ZXZpaXBibGNqdWt2eHJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NjY1NDMsImV4cCI6MjA3MjQ0MjU0M30.LJmmMKDASQfvDo4D_S-tbHDUh2jUb2VuFwl3EqrLBas';
        
        let supabase = null;
        
        // Inicializar app
        document.addEventListener('DOMContentLoaded', function() {
            inicializarSupabase();
            carregarDashboard();
            inicializarCollapsibles();
        });
        
        function inicializarSupabase() {
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                document.getElementById('connectionStatus').innerHTML = '✅ Conectado ao banco de dados';
                document.getElementById('connectionStatus').className = 'connection-status connected';
            } catch (error) {
                console.error('Erro ao conectar:', error);
                document.getElementById('connectionStatus').innerHTML = '❌ Erro na conexão com banco';
                document.getElementById('connectionStatus').className = 'connection-status disconnected';
            }
        }
        
        function inicializarCollapsibles() {
            const collapsibles = document.querySelectorAll('.collapsible');
            collapsibles.forEach(collapsible => {
                collapsible.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    content.classList.toggle('active');
                });
            });
        }
        
        // Gerenciamento de tabs
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                carregarDashboard();
            } else if (tabName === 'historico') {
                carregarHistorico();
            }
        }
        
        // Dashboard
        async function carregarDashboard() {
            if (!supabase) return;
            
            try {
                const { data: analises, error } = await supabase
                    .from('analises_regua3')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Erro ao buscar análises:', error);
                    return;
                }
                
                const stats = calcularEstatisticas(analises || []);
                atualizarDashboard(stats);
                criarGrafico(stats);
                
                const ultimasAnalises = (analises || []).slice(0, 10);
                atualizarTabelaUltimas(ultimasAnalises);
                
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }
        
        function calcularEstatisticas(analises) {
            const stats = {
                total: analises.length,
                acertos: 0,
                verdeEscuro: { total: 0, acertos: 0 },
                verdeClaro: { total: 0, acertos: 0 },
                amarelo: { total: 0, acertos: 0 },
                laranja: { total: 0, acertos: 0 },
                vermelho: { total: 0, acertos: 0 }
            };
            
            analises.forEach(analise => {
                const acertou = analise.acerto && (analise.acerto.includes('✅') || analise.acerto.includes('Pleno'));
                if (acertou) stats.acertos++;
                
                const nivel = analise.nivel_confianca || '';
                if (nivel.includes('Verde Escuro')) {
                    stats.verdeEscuro.total++;
                    if (acertou) stats.verdeEscuro.acertos++;
                } else if (nivel.includes('Verde Claro')) {
                    stats.verdeClaro.total++;
                    if (acertou) stats.verdeClaro.acertos++;
                } else if (nivel.includes('Amarelo')) {
                    stats.amarelo.total++;
                    if (acertou) stats.amarelo.acertos++;
                } else if (nivel.includes('Laranja')) {
                    stats.laranja.total++;
                    if (acertou) stats.laranja.acertos++;
                } else if (nivel.includes('Vermelho')) {
                    stats.vermelho.total++;
                    if (acertou) stats.vermelho.acertos++;
                }
            });
            
            return stats;
        }
        
        function atualizarDashboard(stats) {
            document.getElementById('totalJogos').textContent = stats.total;
            document.getElementById('taxaAcerto').textContent = 
                stats.total > 0 ? Math.round((stats.acertos / stats.total) * 100) + '%' : '0%';
            document.getElementById('verdeEscuroAcerto').textContent = 
                stats.verdeEscuro.total > 0 ? Math.round((stats.verdeEscuro.acertos / stats.verdeEscuro.total) * 100) + '%' : '0%';
            document.getElementById('verdeClaroAcerto').textContent = 
                stats.verdeClaro.total > 0 ? Math.round((stats.verdeClaro.acertos / stats.verdeClaro.total) * 100) + '%' : '0%';
            document.getElementById('amareloAcerto').textContent = 
                stats.amarelo.total > 0 ? Math.round((stats.amarelo.acertos / stats.amarelo.total) * 100) + '%' : '0%';
            document.getElementById('laranjaAcerto').textContent = 
                stats.laranja.total > 0 ? Math.round((stats.laranja.acertos / stats.laranja.total) * 100) + '%' : '0%';
        }
        
        function criarGrafico(stats) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            if (window.myChart) {
                window.myChart.destroy();
            }
            
            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Verde Escuro', 'Verde Claro', 'Amarelo', 'Laranja', 'Vermelho'],
                    datasets: [{
                        label: 'Taxa de Acerto (%)',
                        data: [
                            stats.verdeEscuro.total > 0 ? Math.round((stats.verdeEscuro.acertos / stats.verdeEscuro.total) * 100) : 0,
                            stats.verdeClaro.total > 0 ? Math.round((stats.verdeClaro.acertos / stats.verdeClaro.total) * 100) : 0,
                            stats.amarelo.total > 0 ? Math.round((stats.amarelo.acertos / stats.amarelo.total) * 100) : 0,
                            stats.laranja.total > 0 ? Math.round((stats.laranja.acertos / stats.laranja.total) * 100) : 0,
                            stats.vermelho.total > 0 ? Math.round((stats.vermelho.acertos / stats.vermelho.total) * 100) : 0
                        ],
                        backgroundColor: ['#1e7e34', '#28a745', '#ffc107', '#fd7e14', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }
        
        function atualizarTabelaUltimas(analises) {
            const tbody = document.querySelector('#ultimasAnalises tbody');
            tbody.innerHTML = '';
            
            analises.forEach(analise => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${analise.jogo || '-'}</td>
                    <td><span class="confidence-indicator ${getClasseNivel(analise.nivel_confianca || '')}">${analise.nivel_confianca || '-'}</span></td>
                    <td>${analise.cenario_classificacao || '-'}</td>
                    <td>${analise.previsao_regua || '-'}</td>
                    <td>${analise.resultado_real || '-'}</td>
                    <td>${analise.acerto || '-'}</td>
                `;
            });
        }
        
        function getClasseNivel(nivel) {
            if (nivel.includes('Verde Escuro')) return 'verde-escuro';
            if (nivel.includes('Verde Claro')) return 'verde-claro';
            if (nivel.includes('Amarelo')) return 'amarelo';
            if (nivel.includes('Laranja')) return 'laranja';
            if (nivel.includes('Vermelho')) return 'vermelho';
            return '';
        }
        
        // Nova Análise com Régua 3.0 Completa
        document.getElementById('novaAnaliseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!supabase) {
                alert('❌ Erro na conexão com banco de dados!');
                return;
            }
            
            const jogo = document.getElementById('jogoInput').value;
            const campeonato = document.getElementById('campeonatoInput').value;
            const urls = [
                document.getElementById('url1').value,
                document.getElementById('url2').value,
                document.getElementById('url3').value
            ].filter(url => url.trim());
            
            if (urls.length === 0) {
                alert('❌ Adicione pelo menos uma URL de notícia!');
                return;
            }
            
            // Mostrar progresso
            document.getElementById('analysisSteps').style.display = 'block';
            document.getElementById('resultadoAnalise').innerHTML = '';
            document.getElementById('analisarBtn').disabled = true;
            
            try {
                await analisarComRegua3(jogo, campeonato, urls);
            } catch (error) {
                console.error('Erro na análise:', error);
                document.getElementById('resultadoAnalise').innerHTML = `
                    <div class="error">
                        <h3>❌ Erro na Análise</h3>
                        <p>${error.message}</p>
                        <p><small>Verifique se a chave OpenAI está configurada corretamente.</small></p>
                    </div>
                `;
            } finally {
                document.getElementById('analisarBtn').disabled = false;
            }
        });
        
        async function analisarComRegua3(jogo, campeonato, urls) {
            // Passo 1: Coletar dados
            updateStep('step1', 'active');
            const conteudos = await extrairConteudoURLs(urls);
            updateStep('step1', 'complete');
            
            // Passo 2: Aplicar diretrizes
            updateStep('step2', 'active');
            await new Promise(resolve => setTimeout(resolve, 1000)); // Simular processamento
            updateStep('step2', 'complete');
            
            // Passo 3: Camada 1
            updateStep('step3', 'active');
            await new Promise(resolve => setTimeout(resolve, 1000));
            updateStep('step3', 'complete');
            
            // Passo 4: Camada 2
            updateStep('step4', 'active');
            await new Promise(resolve => setTimeout(resolve, 1000));
            updateStep('step4', 'complete');
            
            // Passo 5: Análise com OpenAI
            updateStep('step5', 'active');
            const analiseCompleta = await analisarConteudoComRegua3(jogo, campeonato, conteudos);
            updateStep('step5', 'complete');
            
            // Passo 6: Salvar no banco
            updateStep('step6', 'active');
            await salvarAnaliseNoBanco(analiseCompleta);
            updateStep('step6', 'complete');
            
            // Mostrar resultado
            mostrarResultadoAnalise(analiseCompleta);
            carregarDashboard();
        }
        
        function updateStep(stepId, status) {
            const step = document.getElementById(stepId);
            const icon = step.querySelector('.step-icon');
            
            icon.className = `step-icon step-${status}`;
            
            if (status === 'complete') {
                icon.innerHTML = '✓';
            } else if (status === 'error') {
                icon.innerHTML = '✗';
            }
        }
        
        async function extrairConteudoURLs(urls) {
            const conteudos = [];
            
            for (const url of urls) {
                try {
                    // Usar um proxy CORS ou serviço de extração
                    const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                    const data = await response.json();
                    
                    // Extrair texto relevante (simplificado)
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data.contents, 'text/html');
                    const texto = doc.body.innerText.substring(0, 3000); // Primeiros 3000 caracteres
                    
                    conteudos.push({
                        url: url,
                        conteudo: texto
                    });
                } catch (error) {
                    console.error(`Erro ao extrair ${url}:`, error);
                    conteudos.push({
                        url: url,
                        conteudo: 'Erro ao extrair conteúdo'
                    });
                }
            }
            
            return conteudos;
        }
        
        async function analisarConteudoComRegua3(jogo, campeonato, conteudos) {
            // Prompt completo da Régua 3.0
            const promptCompleto = `Você é um Analista de Futebol Sênior, autônomo e proativo. Sua tarefa é realizar uma análise completa de uma partida de futebol usando a metodologia "Régua 3.0 - Análise de Dupla Camada".

DADOS DA PARTIDA:
Campeonato: ${campeonato}
Partida: ${jogo}

DIRETRIZES DE ANÁLISE AVANÇADA (REGRAS DE PONDERAÇÃO):
Antes de iniciar a avaliação, você deve aplicar as seguintes diretrizes de ponderação para cenários específicos do futebol brasileiro ou internacional. Elas se sobrepõem à avaliação padrão para garantir uma análise mais precisa e sutil.

Diretriz 1: "Regra do Desgaste Logístico" (Análogo à Vantagem Extrema)
Cenário: Se uma equipe (especialmente a visitante) jogou uma partida decisiva de mata-mata no meio da semana, envolvendo uma viagem longa (ex: jogo da Libertadores na Colômbia na quarta, e jogo do Brasileirão em Fortaleza no sábado).
Ação: O critério J (Logística/Fadiga) desta equipe deve ser travado em uma nota muito baixa (≤ 3/10). O critério C (Desfalques) deve ser avaliado com a premissa de que o time provavelmente será misto ou reserva. A análise deve explicitamente considerar um jogo de baixa intensidade por parte desta equipe, aumentando a chance de um resultado surpreendente.

Diretriz 2: "Regra do Clássico de Desespero" (Análogo ao Equilíbrio Tático do 0x0)
Cenário: Se a partida é um clássico regional onde um time luta na parte de cima da tabela (título/G4) e o outro luta desesperadamente contra o rebaixamento (Z4).
Ação: O critério B (Motivação) do time que luta contra o rebaixamento deve receber nota máxima (10/10). O critério D (Psicológico) do time favorito deve ser analisado com um viés de "risco de complacência" ou "pressão da obrigação de vencer", enquanto o do time desesperado deve ser visto como "jogando a vida". A análise deve reconhecer que a diferença técnica entre as equipes é parcialmente neutralizada por essa carga emocional extrema.

Diretriz 3: "Regra do Fator Climático/Campo" (Análogo da Altitude)
Cenário: Se um jogo ocorrer em condições climáticas extremas (ex: calor de 35°C+ ao meio-dia) ou em um gramado comprovadamente ruim e pesado.
Ação: O critério F (Mando de Campo) do time da casa deve ser potencializado. Na justificativa do critério G (Elenco/Estratégia), você deve explicitamente reduzir o peso da superioridade técnica do time visitante se ele for uma equipe de "toque de bola", explicando que a condição extrema nivela o jogo para um confronto mais físico e de menor qualidade técnica.

Diretriz 4: Regra do Leão Ferido" (Análogo à Reversão à Média):
Cenário: Quando uma equipe com elenco de qualidade comprovada (G6/G8 em potencial) entra em uma sequência de 3+ jogos sem vencer e joga em casa contra um adversário em boa fase, mas de nível técnico similar ou ligeiramente inferior.
Ação Proposta: O critério F (Mando de Campo) desta equipe deve ser potencializado (nota ≥ 9). O critério H (Forma Recente) do adversário (que está em boa fase) deve ter seu peso reduzido na análise qualitativa, com a justificativa de que "sequências de vitória são difíceis de manter fora de casa contra adversários qualificados e pressionados". A análise de gols deve pender para "Acima de 2.5", pois o time da casa jogará de forma mais agressiva e exposta para dar uma resposta.

Diretriz 5: Alerta de Zebra por Calamidade" (O Fator Superação):
Cenário: Quando uma equipe (especialmente a mandante) sofre uma crise de desfalques massiva (5+ jogadores importantes fora), mas enfrenta um adversário que não está sob o mesmo nível de pressão (não é um jogo de vida ou morte para o visitante).
Ação Proposta: A análise deve explicitamente classificar o jogo como de "Risco Imponderável". O palpite principal deve ser evitado. A recomendação para a Loteca deve ser, obrigatoriamente, um Triplo (1X2). A análise qualitativa deve destacar que "a lógica analítica aponta para o visitante, mas o cenário de superação do time da casa torna o jogo imprevisível e propenso a um resultado chocante".

Diretriz 6: Regra da Ressaca Heroica" (O Efeito Pós-Glória):
Cenário: Quando uma equipe vem de um grande feito no meio da semana (classificação em mata-mata, vitória em clássico, conquista de título) e enfrenta, no fim de semana, um adversário teoricamente mais fraco ou em má fase, especialmente fora de casa.
Ação Proposta:
Reavaliação do Critério D (Psicológico): A nota não deve ser automaticamente alta. A justificativa deve ser dividida: "A confiança está alta, mas há um risco significativo de 'ressaca' e relaxamento, o que pode neutralizar o ímpeto positivo." A nota deve ser moderada (6/10 ou 7/10), em vez de alta (9/10 ou 10/10).
Potencialização do Risco: Na análise final (Passo 3), o cenário deve ser classificado como de "Risco de Complacência".
Ajuste na Recomendação de Aposta: A aposta seca no time que vem do "grande feito" deve ser evitada. A recomendação de segurança deve pender para um Duplo Aberto (12) ou até mesmo um Triplo, reconhecendo que o relaxamento do favorito aumenta drasticamente a chance de uma vitória do azarão.

Diretriz 7: Regra da Reversão à Média" (O Despertar do Gigante Adormecido):
Cenário: Quando uma equipe com elenco estruturalmente superior (avaliado com nota ≥ 8 no Critério 1) enfrenta um jejum de vitórias prolongado (5+ jogos) contra um adversário de elenco inferior, mas que vive uma boa fase.
Ação Proposta:
Alerta de Ponderação: A análise deve reconhecer que "a probabilidade de uma quebra de padrão aumenta a cada jogo". O peso do Critério H (Forma Recente) deve ser explicitamente reduzido na análise qualitativa.
Valorização do Elenco: O Critério 1 (Qualidade Estrutural do Elenco) do time superior deve ser destacado como um "fator latente" que pode se manifestar a qualquer momento.
Análise de Risco: O jogo deve ser classificado como de "Alto Risco de Reversão à Média".
Recomendação de Aposta: A aposta seca deve ser evitada a todo custo. A recomendação para a Loteca deve ser, no mínimo, um Duplo Aberto (12), cobrindo a vitória do favorito da "fase" (CRB) e a vitória do favorito da "estrutura" (Athletico). Um Triplo é o mais indicado.

Diretriz 8 – Times de Meio de Tabela x Mandantes Desesperados
Conceito: Equipes de meio de tabela (7º a 12º lugar) não têm força de imposição suficiente quando enfrentam mandantes desesperados no Z4 em casa.
Nesses cenários, o "fator sobrevivência" do mandante deve neutralizar o favoritismo do visitante médio, mesmo que o estrutural seja superior.
Aplicação por competição:
Série B (obrigatória): Visitantes posicionados do 7º lugar para baixo → nunca podem receber Verde Escuro ou Verde Claro contra mandante do Z4 em casa.
Cenário deve ser rebaixado no mínimo para Amarelo, sempre incluindo empate como placar provável (0x0, 1x1, 2x1 Z4).
Série A (aplicação parcial): Se o visitante estiver entre 8º e 12º → regra válida.
Se for G4/G6 ou clube de grande elenco (mesmo em 7º), mantém-se a leitura normal.
Ligas Europeias (dispensada): Em geral, times de meio de tabela europeus mantêm superioridade clara contra Z4.
Só aplicar se houver crise específica documentada (ex.: protestos, salários atrasados, racha interno).

Diretriz 9 - Empate na Ida
Regra: Se o favorito empatar o jogo da ida fora de casa, rebaixar automaticamente um nível de cor.
Exemplo: Verde Escuro → Verde Claro
Exemplo: Verde Claro → Amarelo
Exceção: Não rebaixar se o empate for jogo protocolar — isto é, quando o favorito já ganhou a ida por 3+ gols e apenas poupou jogadores na volta.
Justificativa: O empate fora indica que o azarão tem competitividade e moral para brigar na volta.
Portanto, mesmo que o favorito mantenha diferença de pontos suficiente para Verde Escuro, o cenário deixa de ser "limpo" e precisa ser ajustado para refletir o risco.

Diretriz 10 – O Miolo Perigosíssimo
Conceito: Quando a diferença de pontos circunstanciais entre as equipes é mínima (0 a 2 pontos), o jogo entra no chamado Miolo da Régua.
Esse é o território da imprevisibilidade máxima, onde fatores externos (arbitragem, bola parada, erro individual, expulsão, pressão psicológica) tendem a decidir o resultado.
Aplicação:
• Classificação: Vermelho (<60%) → Perigosíssimo.
• Recomendação oficial: Sempre Triplo (1X2).
• Viés de placar: não existe viés confiável. Se forem citados cenários de placar (0x0, 1x1, 1x0, 0x1), devem ser entendidos apenas como exemplos possíveis dentro do Triplo, e nunca como tendência.
• Histórico: até agora, os registros da retrospectiva mostram que visitantes têm se beneficiado com vitórias em detalhes, ainda que os mandantes dominem estatísticas.
Justificativa:
• O "miolo" é onde a Régua perde capacidade de cravar tendência, pois o equilíbrio é real e absoluto.
• O mandante pode ter posse e volume, mas o visitante pode vencer com frieza e eficiência.
• A zebra mora aqui: é o setor em que mais se observa resultado decidido por lances isolados.

Diretriz 11 – Alerta de Zebra (Verde Claro)
Cenário: Quando o jogo for classificado como Verde Claro (80–89%), ativar o "Alerta de Zebra".
Checklist de Verificação Secundária:
- O favorito costuma golear adversários fechados ou vence com placares magros?
- O visitante possui boa defesa fora de casa ou contra-ataque perigoso?
- O favorito tem desfalques relevantes no setor ofensivo/ criativo?
Ação:
- Se 2 ou mais respostas indicarem risco → rebaixar a confiança para faixa Amarela (~75%).
- Recomendação: mudar de aposta seca para Duplo Aberto (12) ou, no mínimo, Duplo Fechado (1X).
- Mensagem explícita no veredito: ⚠️ ALERTA DE ZEBRA VERDE CLARO – O favoritismo está fragilizado.
Ajuste de Ponderação:
- Reduzir levemente o peso de F (Mando de Campo).
- Aumentar o peso de H (Forma Recente) do visitante.

Diretriz 12 – Volatilidade Amarela
Cenário: Quando o jogo for classificado como Amarelo (70–79%), entender como Zona da Volatilidade.
Checklist de Potencial Ofensivo do Azarão:
- O azarão tem média de gols alta em casa?
- A defesa do favorito é frágil fora de casa?
- Há um artilheiro em boa fase no azarão?
Ação:
- Se 2+ respostas forem positivas → incluir placares elásticos (ex: 2x0, 3x1 para o azarão).
- Ajustar mercado de gols para Over 2.5/3.5.
- Alterar nomenclatura: 🟡 Amarelo Volátil – Risco de Goleada/Resultado Elástico.
Integração com Ressaca Heroica (Diretriz 6):
- Se o favorito vem de grande feito → automaticamente baixar nota do Psicológico (D) e Logística (J).
- Mensagem explícita no veredito: ⚠️ ALERTA DE RESSACA HEROICA – O favoritismo está comprometido.

FLUXO DE TRABALHO OBRIGATÓRIO:
Fase de Coleta de Dados (Trabalho Interno): Antes de iniciar a análise, realize uma pesquisa interna e/ou externa para coletar os dados contextuais. Você deve buscar ativamente por:
Posição na tabela e campanha geral.
Resultados dos últimos 5 jogos de cada equipe.
Notícias recentes sobre desfalques confirmados ou prováveis (lesões, suspensões).
Clima interno dos clubes (crise, euforia, pressão).
Histórico recente de confrontos diretos.
Informações sobre logística (sequência de jogos, viagens recentes).

METODOLOGIA: Régua 3.0 - Análise de Dupla Camada

PASSO 1: ANÁLISE DA CAMADA 1 - FORÇA CIRCUNSTANCIAL (RÉGUA 2.3)
Com base nos dados que você coletou, avalie cada time de 0 a 10 nos seguintes critérios, justificando cada nota com as informações encontradas.
B. Motivação: (Baseado na importância do jogo, rivalidade, objetivos).
C. Desfalques: (Baseado nas notícias de ausências confirmadas/prováveis).
D. Psicológico: (Baseado no clima recente, confiança, pressão da torcida/mídia).
E. Momento na Tabela: (Baseado na classificação e necessidade do resultado).
F. Mando de Campo: (Considerando o estádio, torcida e condições locais).
G. Elenco/Estratégia Tática: (Analisando o encaixe tático para este confronto).
H. Forma Recente: (Baseado nos resultados e performance dos últimos jogos coletados).
I. Confronto Direto: (Baseado no histórico recente que você pesquisou).
J. Logística/Fadiga: (Baseado na sequência de jogos e viagens recentes).

PASSO 2: ANÁLISE DA CAMADA 2 - ÍNDICE DE FORÇA ESTRUTURAL ("ÍNDICE PRÁTICO")
Com base no seu conhecimento geral sobre os clubes, avalie cada time de 0 a 10 nos seguintes critérios fundamentais, justificando as notas.
1. Qualidade Estrutural do Elenco (Peso 3): (Força, profundidade e poder de decisão do plantel no geral).
2. Consistência e Padrão Tático (Peso 2): (Estabilidade de performance ao longo do campeonato, solidez do modelo de jogo).
3. Resiliência Mental / "Casca" (Peso 2): (Histórico do time em reagir à adversidade e pressão).
4. Fator Técnico/Gerencial (Peso 1): (Qualidade do treinador e organização do clube).

PASSO 3: VEREDITO FINAL - ANÁLISE DE CONFLITO E OPORTUNIDADE
Compare os resultados das Camadas 1 e 2 para determinar o cenário do jogo.

Ajuste do Índice de Confiança (Nova Escala):
🟢 Verde Escuro (90–100%) → Favoritismo consolidado e cenário limpo (sem risco de zebra ou reversão).
👉 Apostar seco / coluna única.
🟢 Verde Claro (80–89%) → Favoritismo sólido, mas com pequenas incertezas.
👉 Recomendação: 1 ou 2, segurança 1X/2X.
🟡 Amarelo (70–79%) → Jogo instável, favoritismo frágil (mandantes médios da Série B, clássicos equilibrados).
👉 Duplo obrigatório (1X ou X2).
🟠 Laranja (60–69%) → Alto risco, fatores de zebra ou reversão à média ativos.
👉 Duplo aberto (12) ou Triplo.
🔴 Vermelho (<60%) → Jogo imponderável (crise, protestos, times mistos).
👉 Triplo (1X2).

4. Recomendações Práticas (Saída Final): Com base em todo o seu diagnóstico, forneça recomendações claras para os seguintes mercados:
Resultado Mais Provável: (Ex: Vitória do Mandante).
Placares Mais Prováveis: (Liste 2 ou 3 placares que melhor refletem a análise. Ex: 2x1, 1x0).
Mercado de Gols (Over/Under): (Recomende "Acima de 2.5" ou "Abaixo de 2.5" gols, justificando com base no cenário de ataque vs. defesa).
Ambos Marcam (BTTS): (Recomende "Sim" ou "Não", justificando com base na probabilidade de o time mais fraco marcar).
Recomendação para Loteca: (Indique "Coluna 1", "Coluna do Meio", "Coluna 2". Em caso de alto risco de zebra ou equilíbrio, sugira um "Duplo" ou, em casos extremos, um "Triplo").

CONTEÚDO DAS NOTÍCIAS:
${conteudos.map(c => `URL: ${c.url}\nConteúdo: ${c.conteudo}`).join('\n\n')}

Responda OBRIGATORIAMENTE em formato JSON estruturado com as seguintes chaves:
{
  "coleta_dados": {
    "posicao_tabela": "string",
    "ultimos_jogos": "string",
    "desfalques": "string",
    "clima_interno": "string",
    "historico_confrontos": "string",
    "logistica": "string"
  },
  "camada1_circunstancial": {
    "mandante": {
      "motivacao": {"nota": 0, "justificativa": "string"},
      "desfalques": {"nota": 0, "justificativa": "string"},
      "psicologico": {"nota": 0, "justificativa": "string"},
      "momento_tabela": {"nota": 0, "justificativa": "string"},
      "mando_campo": {"nota": 0, "justificativa": "string"},
      "elenco_estrategia": {"nota": 0, "justificativa": "string"},
      "forma_recente": {"nota": 0, "justificativa": "string"},
      "confronto_direto": {"nota": 0, "justificativa": "string"},
      "logistica_fadiga": {"nota": 0, "justificativa": "string"},
      "total": 0
    },
    "visitante": {
      "motivacao": {"nota": 0, "justificativa": "string"},
      "desfalques": {"nota": 0, "justificativa": "string"},
      "psicologico": {"nota": 0, "justificativa": "string"},
      "momento_tabela": {"nota": 0, "justificativa": "string"},
      "mando_campo": {"nota": 0, "justificativa": "string"},
      "elenco_estrategia": {"nota": 0, "justificativa": "string"},
      "forma_recente": {"nota": 0, "justificativa": "string"},
      "confronto_direto": {"nota": 0, "justificativa": "string"},
      "logistica_fadiga": {"nota": 0, "justificativa": "string"},
      "total": 0
    },
    "semaforo_jogo": "string"
  },
  "camada2_estrutural": {
    "mandante": {
      "qualidade_elenco": {"nota": 0, "peso": 3, "justificativa": "string"},
      "consistencia_tatica": {"nota": 0, "peso": 2, "justificativa": "string"},
      "resiliencia_mental": {"nota": 0, "peso": 2, "justificativa": "string"},
      "fator_gerencial": {"nota": 0, "peso": 1, "justificativa": "string"},
      "total_ponderado": 0
    },
    "visitante": {
      "qualidade_elenco": {"nota": 0, "peso": 3, "justificativa": "string"},
      "consistencia_tatica": {"nota": 0, "peso": 2, "justificativa": "string"},
      "resiliencia_mental": {"nota": 0, "peso": 2, "justificativa": "string"},
      "fator_gerencial": {"nota": 0, "peso": 1, "justificativa": "string"},
      "total_ponderado": 0
    }
  },
  "veredito_final": {
    "vencedor_circunstancial": "string",
    "vencedor_estrutural": "string",
    "cenario_classificacao": "string",
    "nivel_confianca": "string",
    "percentual_confianca": 0,
    "diretrizes_aplicadas": ["string"],
    "analise_final": "string"
  },
  "recomendacoes": {
    "resultado_provavel": "string",
    "placares_provaveis": ["string"],
    "mercado_gols": "string",
    "ambos_marcam": "string",
    "loteca": "string"
  }
}`;
            
            try {
                // Fazer chamada para OpenAI via Netlify Functions (ou endpoint configurado)
                const response = await fetch('/.netlify/functions/openai-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [
                            {
                                role: 'system',
                                content: 'Você é um especialista em análise de futebol que segue rigorosamente a metodologia "Régua 3.0 - Análise de Dupla Camada". Sempre responda em JSON estruturado conforme solicitado.'
                            },
                            {
                                role: 'user',
                                content: promptCompleto
                            }
                        ],
                        model: 'gpt-4',
                        temperature: 0,
                        max_tokens: 4096
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.status}`);
                }
                
                const data = await response.json();
                const analiseTexto = data.choices[0].message.content;
                
                // Parse do JSON retornado
                const analiseJSON = JSON.parse(analiseTexto);
                
                // Adicionar metadados
                analiseJSON.jogo = jogo;
                analiseJSON.campeonato = campeonato;
                analiseJSON.urls = urls;
                analiseJSON.timestamp = new Date().toISOString();
                
                return analiseJSON;
                
            } catch (error) {
                console.error('Erro na análise OpenAI:', error);
                
                // Fallback com análise simulada para demonstração
                return {
                    jogo: jogo,
                    campeonato: campeonato,
                    urls: urls,
                    timestamp: new Date().toISOString(),
                    coleta_dados: {
                        posicao_tabela: "Dados coletados das URLs fornecidas",
                        ultimos_jogos: "Últimos 5 jogos analisados",
                        desfalques: "Desfalques identificados",
                        clima_interno: "Clima interno avaliado",
                        historico_confrontos: "Histórico recente analisado",
                        logistica: "Logística e fadiga consideradas"
                    },
                    camada1_circunstancial: {
                        mandante: {
                            motivacao: {nota: 8, justificativa: "Alta motivação para o confronto"},
                            desfalques: {nota: 7, justificativa: "Poucos desfalques importantes"},
                            psicologico: {nota: 7, justificativa: "Confiança moderada"},
                            momento_tabela: {nota: 6, justificativa: "Posição intermediária"},
                            mando_campo: {nota: 8, justificativa: "Forte apoio da torcida"},
                            elenco_estrategia: {nota: 7, justificativa: "Boa organização tática"},
                            forma_recente: {nota: 6, justificativa: "Forma irregular"},
                            confronto_direto: {nota: 5, justificativa: "Histórico equilibrado"},
                            logistica_fadiga: {nota: 8, justificativa: "Boa condição física"},
                            total: 62
                        },
                        visitante: {
                            motivacao: {nota: 7, justificativa: "Motivação alta"},
                            desfalques: {nota: 6, justificativa: "Alguns desfalques"},
                            psicologico: {nota: 6, justificativa: "Pressão moderada"},
                            momento_tabela: {nota: 7, justificativa: "Boa posição"},
                            mando_campo: {nota: 4, justificativa: "Jogando fora de casa"},
                            elenco_estrategia: {nota: 8, justificativa: "Elenco qualificado"},
                            forma_recente: {nota: 7, justificativa: "Boa sequência"},
                            confronto_direto: {nota: 5, justificativa: "Histórico equilibrado"},
                            logistica_fadiga: {nota: 7, justificativa: "Condição adequada"},
                            total: 57
                        },
                        semaforo_jogo: "Instável (diferença de 5 pontos)"
                    },
                    camada2_estrutural: {
                        mandante: {
                            qualidade_elenco: {nota: 7, peso: 3, justificativa: "Elenco de qualidade média"},
                            consistencia_tatica: {nota: 6, peso: 2, justificativa: "Padrão tático em desenvolvimento"},
                            resiliencia_mental: {nota: 7, peso: 2, justificativa: "Boa capacidade de reação"},
                            fator_gerencial: {nota: 7, peso: 1, justificativa: "Treinador experiente"},
                            total_ponderado: 54
                        },
                        visitante: {
                            qualidade_elenco: {nota: 8, peso: 3, justificativa: "Elenco superior"},
                            consistencia_tatica: {nota: 7, peso: 2, justificativa: "Padrão bem definido"},
                            resiliencia_mental: {nota: 6, peso: 2, justificativa: "Resiliência moderada"},
                            fator_gerencial: {nota: 8, peso: 1, justificativa: "Excelente comando técnico"},
                            total_ponderado: 58
                        }
                    },
                    veredito_final: {
                        vencedor_circunstancial: "Mandante",
                        vencedor_estrutural: "Visitante",
                        cenario_classificacao: "Jogo de Risco do Favorito",
                        nivel_confianca: "Amarelo",
                        percentual_confianca: 75,
                        diretrizes_aplicadas: ["Diretriz 4: Regra do Leão Ferido", "Diretriz 12: Volatilidade Amarela"],
                        analise_final: "Confronto equilibrado com ligeira vantagem circunstancial para o mandante, mas superioridade estrutural do visitante. O cenário sugere um jogo disputado com resultado em aberto, recomendando cautela nas apostas."
                    },
                    recomendacoes: {
                        resultado_provavel: "Empate ou Vitória do Visitante",
                        placares_provaveis: ["1x1", "0x1", "2x1"],
                        mercado_gols: "Abaixo de 2.5 gols",
                        ambos_marcam: "Sim",
                        loteca: "Duplo (1X)"
                    }
                };
            }
        }
        
        async function salvarAnaliseNoBanco(analise) {
            if (!supabase) return;
            
            try {
                const { data, error } = await supabase
                    .from('analises_regua3')
                    .insert([{
                        jogo: analise.jogo,
                        campeonato: analise.campeonato,
                        urls: analise.urls,
                        coleta_dados: analise.coleta_dados,
                        camada1_circunstancial: analise.camada1_circunstancial,
                        camada2_estrutural: analise.camada2_estrutural,
                        veredito_final: analise.veredito_final,
                        recomendacoes: analise.recomendacoes,
                        nivel_confianca: analise.veredito_final.nivel_confianca,
                        percentual_confianca: analise.veredito_final.percentual_confianca,
                        cenario_classificacao: analise.veredito_final.cenario_classificacao,
                        previsao_regua: analise.recomendacoes.resultado_provavel,
                        created_at: new Date().toISOString()
                    }]);
                
                if (error) {
                    console.error('Erro ao salvar:', error);
                    throw error;
                }
                
                console.log('Análise salva com sucesso:', data);
                
            } catch (error) {
                console.error('Erro ao salvar análise:', error);
                throw error;
            }
        }
        
        function mostrarResultadoAnalise(analise) {
            const resultado = document.getElementById('resultadoAnalise');
            
            resultado.innerHTML = `
                <div class="analysis-section">
                    <h3>🎯 Análise Completa - ${analise.jogo}</h3>
                    <p><strong>Campeonato:</strong> ${analise.campeonato}</p>
                    
                    <div class="confidence-indicator ${getClasseNivel(analise.veredito_final.nivel_confianca)}">
                        ${analise.veredito_final.nivel_confianca} (${analise.veredito_final.percentual_confianca}%)
                    </div>
                    
                    <p><strong>Cenário:</strong> ${analise.veredito_final.cenario_classificacao}</p>
                    <p><strong>Diretrizes Aplicadas:</strong> ${analise.veredito_final.diretrizes_aplicadas.join(', ')}</p>
                </div>
                
                <button class="collapsible">📊 Camada 1: Análise Circunstancial</button>
                <div class="collapsible-content">
                    <div class="layer-analysis">
                        <div class="team-analysis">
                            <h4>🏠 ${analise.jogo.split(' x ')[0]} (Mandante)</h4>
                            <p><strong>Total:</strong> ${analise.camada1_circunstancial.mandante.total}/90</p>
                            <table class="criteria-table">
                                <tr><th>Critério</th><th>Nota</th><th>Justificativa</th></tr>
                                <tr><td>Motivação</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.motivacao.nota)}">${analise.camada1_circunstancial.mandante.motivacao.nota}</td><td>${analise.camada1_circunstancial.mandante.motivacao.justificativa}</td></tr>
                                <tr><td>Desfalques</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.desfalques.nota)}">${analise.camada1_circunstancial.mandante.desfalques.nota}</td><td>${analise.camada1_circunstancial.mandante.desfalques.justificativa}</td></tr>
                                <tr><td>Psicológico</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.psicologico.nota)}">${analise.camada1_circunstancial.mandante.psicologico.nota}</td><td>${analise.camada1_circunstancial.mandante.psicologico.justificativa}</td></tr>
                                <tr><td>Momento Tabela</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.momento_tabela.nota)}">${analise.camada1_circunstancial.mandante.momento_tabela.nota}</td><td>${analise.camada1_circunstancial.mandante.momento_tabela.justificativa}</td></tr>
                                <tr><td>Mando Campo</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.mando_campo.nota)}">${analise.camada1_circunstancial.mandante.mando_campo.nota}</td><td>${analise.camada1_circunstancial.mandante.mando_campo.justificativa}</td></tr>
                                <tr><td>Elenco/Estratégia</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.elenco_estrategia.nota)}">${analise.camada1_circunstancial.mandante.elenco_estrategia.nota}</td><td>${analise.camada1_circunstancial.mandante.elenco_estrategia.justificativa}</td></tr>
                                <tr><td>Forma Recente</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.forma_recente.nota)}">${analise.camada1_circunstancial.mandante.forma_recente.nota}</td><td>${analise.camada1_circunstancial.mandante.forma_recente.justificativa}</td></tr>
                                <tr><td>Confronto Direto</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.confronto_direto.nota)}">${analise.camada1_circunstancial.mandante.confronto_direto.nota}</td><td>${analise.camada1_circunstancial.mandante.confronto_direto.justificativa}</td></tr>
                                <tr><td>Logística/Fadiga</td><td class="${getScoreClass(analise.camada1_circunstancial.mandante.logistica_fadiga.nota)}">${analise.camada1_circunstancial.mandante.logistica_fadiga.nota}</td><td>${analise.camada1_circunstancial.mandante.logistica_fadiga.justificativa}</td></tr>
                            </table>
                        </div>
                        <div class="team-analysis">
                            <h4>✈️ ${analise.jogo.split(' x ')[1]} (Visitante)</h4>
                            <p><strong>Total:</strong> ${analise.camada1_circunstancial.visitante.total}/90</p>
                            <table class="criteria-table">
                                <tr><th>Critério</th><th>Nota</th><th>Justificativa</th></tr>
                                <tr><td>Motivação</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.motivacao.nota)}">${analise.camada1_circunstancial.visitante.motivacao.nota}</td><td>${analise.camada1_circunstancial.visitante.motivacao.justificativa}</td></tr>
                                <tr><td>Desfalques</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.desfalques.nota)}">${analise.camada1_circunstancial.visitante.desfalques.nota}</td><td>${analise.camada1_circunstancial.visitante.desfalques.justificativa}</td></tr>
                                <tr><td>Psicológico</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.psicologico.nota)}">${analise.camada1_circunstancial.visitante.psicologico.nota}</td><td>${analise.camada1_circunstancial.visitante.psicologico.justificativa}</td></tr>
                                <tr><td>Momento Tabela</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.momento_tabela.nota)}">${analise.camada1_circunstancial.visitante.momento_tabela.nota}</td><td>${analise.camada1_circunstancial.visitante.momento_tabela.justificativa}</td></tr>
                                <tr><td>Mando Campo</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.mando_campo.nota)}">${analise.camada1_circunstancial.visitante.mando_campo.nota}</td><td>${analise.camada1_circunstancial.visitante.mando_campo.justificativa}</td></tr>
                                <tr><td>Elenco/Estratégia</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.elenco_estrategia.nota)}">${analise.camada1_circunstancial.visitante.elenco_estrategia.nota}</td><td>${analise.camada1_circunstancial.visitante.elenco_estrategia.justificativa}</td></tr>
                                <tr><td>Forma Recente</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.forma_recente.nota)}">${analise.camada1_circunstancial.visitante.forma_recente.nota}</td><td>${analise.camada1_circunstancial.visitante.forma_recente.justificativa}</td></tr>
                                <tr><td>Confronto Direto</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.confronto_direto.nota)}">${analise.camada1_circunstancial.visitante.confronto_direto.nota}</td><td>${analise.camada1_circunstancial.visitante.confronto_direto.justificativa}</td></tr>
                                <tr><td>Logística/Fadiga</td><td class="${getScoreClass(analise.camada1_circunstancial.visitante.logistica_fadiga.nota)}">${analise.camada1_circunstancial.visitante.logistica_fadiga.nota}</td><td>${analise.camada1_circunstancial.visitante.logistica_fadiga.justificativa}</td></tr>
                            </table>
                        </div>
                    </div>
                    <p><strong>Semáforo do Jogo:</strong> ${analise.camada1_circunstancial.semaforo_jogo}</p>
                </div>
                
                <button class="collapsible">🏗️ Camada 2: Análise Estrutural</button>
                <div class="collapsible-content">
                    <div class="layer-analysis">
                        <div class="team-analysis">
                            <h4>🏠 ${analise.jogo.split(' x ')[0]} (Mandante)</h4>
                            <p><strong>Total Ponderado:</strong> ${analise.camada2_estrutural.mandante.total_ponderado}/80</p>
                            <table class="criteria-table">
                                <tr><th>Critério</th><th>Nota</th><th>Peso</th><th>Justificativa</th></tr>
                                <tr><td>Qualidade Elenco</td><td class="${getScoreClass(analise.camada2_estrutural.mandante.qualidade_elenco.nota)}">${analise.camada2_estrutural.mandante.qualidade_elenco.nota}</td><td>3x</td><td>${analise.camada2_estrutural.mandante.qualidade_elenco.justificativa}</td></tr>
                                <tr><td>Consistência Tática</td><td class="${getScoreClass(analise.camada2_estrutural.mandante.consistencia_tatica.nota)}">${analise.camada2_estrutural.mandante.consistencia_tatica.nota}</td><td>2x</td><td>${analise.camada2_estrutural.mandante.consistencia_tatica.justificativa}</td></tr>
                                <tr><td>Resiliência Mental</td><td class="${getScoreClass(analise.camada2_estrutural.mandante.resiliencia_mental.nota)}">${analise.camada2_estrutural.mandante.resiliencia_mental.nota}</td><td>2x</td><td>${analise.camada2_estrutural.mandante.resiliencia_mental.justificativa}</td></tr>
                                <tr><td>Fator Gerencial</td><td class="${getScoreClass(analise.camada2_estrutural.mandante.fator_gerencial.nota)}">${analise.camada2_estrutural.mandante.fator_gerencial.nota}</td><td>1x</td><td>${analise.camada2_estrutural.mandante.fator_gerencial.justificativa}</td></tr>
                            </table>
                        </div>
                        <div class="team-analysis">
                            <h4>✈️ ${analise.jogo.split(' x ')[1]} (Visitante)</h4>
                            <p><strong>Total Ponderado:</strong> ${analise.camada2_estrutural.visitante.total_ponderado}/80</p>
                            <table class="criteria-table">
                                <tr><th>Critério</th><th>Nota</th><th>Peso</th><th>Justificativa</th></tr>
                                <tr><td>Qualidade Elenco</td><td class="${getScoreClass(analise.camada2_estrutural.visitante.qualidade_elenco.nota)}">${analise.camada2_estrutural.visitante.qualidade_elenco.nota}</td><td>3x</td><td>${analise.camada2_estrutural.visitante.qualidade_elenco.justificativa}</td></tr>
                                <tr><td>Consistência Tática</td><td class="${getScoreClass(analise.camada2_estrutural.visitante.consistencia_tatica.nota)}">${analise.camada2_estrutural.visitante.consistencia_tatica.nota}</td><td>2x</td><td>${analise.camada2_estrutural.visitante.consistencia_tatica.justificativa}</td></tr>
                                <tr><td>Resiliência Mental</td><td class="${getScoreClass(analise.camada2_estrutural.visitante.resiliencia_mental.nota)}">${analise.camada2_estrutural.visitante.resiliencia_mental.nota}</td><td>2x</td><td>${analise.camada2_estrutural.visitante.resiliencia_mental.justificativa}</td></tr>
                                <tr><td>Fator Gerencial</td><td class="${getScoreClass(analise.camada2_estrutural.visitante.fator_gerencial.nota)}">${analise.camada2_estrutural.visitante.fator_gerencial.nota}</td><td>1x</td><td>${analise.camada2_estrutural.visitante.fator_gerencial.justificativa}</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <button class="collapsible">🎯 Veredito Final</button>
                <div class="collapsible-content">
                    <p><strong>Vencedor Circunstancial:</strong> ${analise.veredito_final.vencedor_circunstancial}</p>
                    <p><strong>Vencedor Estrutural:</strong> ${analise.veredito_final.vencedor_estrutural}</p>
                    <p><strong>Análise Final:</strong> ${analise.veredito_final.analise_final}</p>
                </div>
                
                <button class="collapsible">📈 Recomendações</button>
                <div class="collapsible-content">
                    <div class="recommendations-grid">
                        <div class="recommendation-card">
                            <h4>🏆 Resultado</h4>
                            <p>${analise.recomendacoes.resultado_provavel}</p>
                        </div>
                        <div class="recommendation-card">
                            <h4>⚽ Placares</h4>
                            <p>${analise.recomendacoes.placares_provaveis.join(', ')}</p>
                        </div>
                        <div class="recommendation-card">
                            <h4>🥅 Gols</h4>
                            <p>${analise.recomendacoes.mercado_gols}</p>
                        </div>
                        <div class="recommendation-card">
                            <h4>⚽⚽ Ambos Marcam</h4>
                            <p>${analise.recomendacoes.ambos_marcam}</p>
                        </div>
                        <div class="recommendation-card">
                            <h4>🎲 Loteca</h4>
                            <p>${analise.recomendacoes.loteca}</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Reativar collapsibles
            inicializarCollapsibles();
        }
        
        function getScoreClass(nota) {
            if (nota >= 8) return 'score-high';
            if (nota >= 6) return 'score-medium';
            return 'score-low';
        }
        
        // Histórico
        async function carregarHistorico() {
            if (!supabase) return;
            
            try {
                const { data: analises, error } = await supabase
                    .from('analises_regua3')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Erro ao buscar histórico:', error);
                    return;
                }
                
                atualizarTabelaHistorico(analises || []);
                
            } catch (error) {
                console.error('Erro ao carregar histórico:', error);
            }
        }
        
        function atualizarTabelaHistorico(analises) {
            const tbody = document.querySelector('#historicoCompleto tbody');
            tbody.innerHTML = '';
            
            analises.forEach(analise => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${analise.jogo || '-'}</td>
                    <td>${analise.campeonato || '-'}</td>
                    <td><span class="confidence-indicator ${getClasseNivel(analise.nivel_confianca || '')}">${analise.nivel_confianca || '-'}</span></td>
                    <td>${analise.cenario_classificacao || '-'}</td>
                    <td>${analise.percentual_confianca || '-'}%</td>
                    <td>${analise.previsao_regua || '-'}</td>
                    <td>${analise.resultado_real || '-'}</td>
                    <td>${analise.acerto || '-'}</td>
                    <td><button class="btn" onclick="verDetalhes('${analise.id}')">Ver Detalhes</button></td>
                `;
            });
        }
        
        function filtrarHistorico() {
            const filtro = document.getElementById('filtroNivel').value;
            carregarHistorico(); // Recarregar com filtro (implementar filtro no backend se necessário)
        }
        
        function verDetalhes(id) {
            // Implementar visualização de detalhes da análise
            alert(`Ver detalhes da análise ${id}`);
        }
    </script>
</body>
</html>
